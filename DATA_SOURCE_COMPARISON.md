# 本地部署 vs 仅前端部署：数据源对比

## 📊 两种部署模式的数据差异

### 模式 1: 本地完整部署（前端 + 后端）

**数据来源**: 本地 JSON 文件

**数据路径**: `mcp/data/*.json`

**数据特点**:
- ✅ **静态数据**: 从本地 JSON 文件读取，数据不会自动更新
- ✅ **可控性强**: 可以修改本地 JSON 文件来测试不同场景
- ✅ **离线可用**: 不需要网络连接（除了前端加载时）
- ⚠️ **数据可能过时**: 文件中的数据可能不是最新的
- ⚠️ **数据量有限**: 通常只有示例数据或快照数据

**数据文件列表**:
```
mcp/data/
├── crypto-prices.json          # 加密货币价格
├── account-totals.json         # 账户总览
├── trades.json                 # 交易记录
├── leaderboard.json            # 排行榜
├── positions.json              # 持仓情况
├── since-inception-values.json # 累计收益曲线
├── analytics.json              # 分析数据
└── conversations.json          # 模型对话
```

**数据加载方式**:
```go
// 后端从文件系统读取 JSON
DataLoader.LoadLeaderboard() 
  → 读取 mcp/data/leaderboard.json
  → 返回 JSON 数据
```

**适用场景**:
- 🎯 本地开发和测试
- 🎯 演示和展示
- 🎯 离线环境
- 🎯 数据分析和调试

---

### 模式 2: 仅前端部署（使用远程 API）

**数据来源**: NOF1 官方 API (`https://nof1.ai/api`)

**数据特点**:
- ✅ **实时数据**: 数据实时更新，反映最新的交易状态
- ✅ **完整历史**: 包含完整的历史交易记录和分析数据
- ✅ **自动更新**: 数据持续更新，无需手动维护
- ✅ **生产级数据**: 真实的生产环境数据
- ⚠️ **需要网络**: 必须连接到互联网
- ⚠️ **不可控**: 无法修改数据来测试特定场景

**数据获取方式**:
```
前端 → Next.js API 代理 → https://nof1.ai/api/leaderboard
```

**适用场景**:
- 🎯 查看实时交易数据
- 🎯 生产环境部署
- 🎯 监控真实交易表现
- 🎯 不需要本地开发环境

---

## 🔍 详细对比

### 1. 数据新鲜度

| 特性 | 本地部署 | 仅前端部署 |
|------|---------|-----------|
| **数据更新频率** | 静态（手动更新文件） | 实时（持续更新） |
| **数据时效性** | 取决于文件最后更新时间 | 实时（秒级更新） |
| **价格数据** | 文件中的快照 | 实时市场价格 |
| **交易记录** | 文件中的历史记录 | 包含最新交易 |

### 2. 数据完整性

| 特性 | 本地部署 | 仅前端部署 |
|------|---------|-----------|
| **历史数据** | 有限（文件中的数据） | 完整（所有历史记录） |
| **交易数量** | 通常较少 | 完整交易历史 |
| **时间范围** | 文件覆盖的时间范围 | 从开始到现在的所有数据 |
| **模型数量** | 文件中的模型 | 所有活跃模型 |

### 3. 数据格式

**相同点**:
- ✅ API 响应格式完全相同
- ✅ 数据结构一致
- ✅ 字段名称相同

**示例对比**:

**本地部署返回** (`http://localhost:8888/api/leaderboard`):
```json
{
  "leaderboard": [
    {
      "id": "qwen3-max",
      "num_trades": 1,
      "sharpe": 0,
      "equity": 10625.12,
      ...
    }
  ]
}
```

**远程 API 返回** (`https://nof1.ai/api/leaderboard`):
```json
{
  "leaderboard": [
    {
      "id": "qwen3-max",
      "num_trades": 150,
      "sharpe": 0.318,
      "equity": 16886.58,
      ...
    }
  ]
}
```

格式相同，但**数据内容不同**（交易数量、收益等）。

### 4. 性能对比

| 特性 | 本地部署 | 仅前端部署 |
|------|---------|-----------|
| **响应速度** | 极快（< 10ms，本地文件） | 较快（50-200ms，网络请求） |
| **网络依赖** | 无（后端本地） | 有（需要访问远程 API） |
| **缓存策略** | 后端可配置缓存 | Next.js 代理层缓存 |
| **并发处理** | 本地处理，无网络延迟 | 受网络条件影响 |

### 5. 数据可定制性

| 特性 | 本地部署 | 仅前端部署 |
|------|---------|-----------|
| **修改数据** | ✅ 可以编辑 JSON 文件 | ❌ 无法修改 |
| **测试场景** | ✅ 可以创建测试数据 | ❌ 只能查看真实数据 |
| **数据过滤** | ✅ 可以修改文件内容 | ❌ 只能使用 API 提供的过滤 |
| **调试数据** | ✅ 可以注入错误数据测试 | ❌ 无法控制 |

---

## 🎯 实际使用场景

### 场景 1: 开发调试

**推荐**: 本地部署

**原因**:
- 可以修改本地 JSON 文件测试边界情况
- 不需要网络连接
- 响应速度快，适合频繁测试
- 可以控制数据内容

**示例**:
```bash
# 修改本地数据文件
vim mcp/data/leaderboard.json

# 重启后端，立即看到变化
./nof0-api -f etc/nof0.yaml
```

### 场景 2: 查看实时数据

**推荐**: 仅前端部署

**原因**:
- 数据实时更新
- 反映真实交易状态
- 包含完整历史数据
- 无需维护本地数据文件

**示例**:
```bash
# 只启动前端，使用远程 API
cd web
npm run dev

# 前端自动使用 https://nof1.ai/api
```

### 场景 3: 演示展示

**推荐**: 本地部署

**原因**:
- 数据稳定，不会因为网络问题中断
- 可以准备特定的演示数据
- 响应速度快，体验好

### 场景 4: 生产环境

**推荐**: 仅前端部署（或自建后端）

**原因**:
- 需要实时数据
- 需要完整历史记录
- 需要高可用性

---

## 🔄 数据同步问题

### 本地数据可能过时

**问题**: 本地 JSON 文件中的数据可能不是最新的

**解决方案**:

1. **定期更新本地数据**:
   ```bash
   # 从远程 API 下载最新数据
   curl https://nof1.ai/api/leaderboard > mcp/data/leaderboard.json
   curl https://nof1.ai/api/trades > mcp/data/trades.json
   # ... 其他端点
   ```

2. **使用数据库模式**:
   ```bash
   # 配置 Postgres + Redis
   # 后端会自动从数据库读取最新数据
   ```

3. **切换到远程 API**:
   ```bash
   # 删除 .env.local，使用默认远程 API
   rm web/.env.local
   ```

---

## 📝 数据文件位置

### 本地部署的数据文件

**默认路径**: `go/../mcp/data/` 或 `mcp/data/`

**配置文件**: `go/etc/nof0.yaml`
```yaml
DataPath: ../mcp/data  # 数据文件路径
```

**查看数据文件**:
```bash
cd /Users/kechenglu/Desktop/Code/nof0
ls -lh mcp/data/*.json
```

### 远程 API 的数据

**API 地址**: `https://nof1.ai/api`

**数据来源**: NOF1 官方服务器（实时数据库）

---

## 🧪 验证数据来源

### 检查当前使用的数据源

**方法 1: 查看环境变量**
```bash
# 本地部署
cat web/.env.local
# 应该看到: NOF1_API_BASE_URL=http://localhost:8888

# 仅前端部署
# .env.local 不存在或指向远程
```

**方法 2: 查看 Next.js 日志**
```bash
# 本地部署会显示:
[API Route] Target URL: http://localhost:8888/api/leaderboard

# 仅前端部署会显示:
[API Route] Target URL: https://nof1.ai/api/leaderboard
```

**方法 3: 比较数据内容**
```bash
# 本地数据
curl http://localhost:8888/api/leaderboard | jq '.leaderboard[0].num_trades'

# 远程数据
curl https://nof1.ai/api/leaderboard | jq '.leaderboard[0].num_trades'

# 如果数字不同，说明数据源不同
```

---

## 💡 最佳实践

### 开发阶段

1. **使用本地部署**:
   - 快速迭代
   - 可以修改测试数据
   - 不依赖网络

2. **定期同步远程数据**:
   ```bash
   # 创建同步脚本
   # sync-data.sh
   curl https://nof1.ai/api/leaderboard > mcp/data/leaderboard.json
   curl https://nof1.ai/api/trades > mcp/data/trades.json
   # ...
   ```

### 生产阶段

1. **使用远程 API**:
   - 实时数据
   - 完整历史
   - 无需维护

2. **或自建后端**:
   - 配置数据库
   - 定期同步数据
   - 完全控制

---

## 📊 数据对比示例

### 排行榜数据对比

**本地数据** (可能):
```json
{
  "leaderboard": [
    {"id": "qwen3-max", "num_trades": 1, "equity": 10625.12},
    {"id": "gpt-5", "num_trades": 1, "equity": 3063.56}
  ]
}
```

**远程数据** (实时):
```json
{
  "leaderboard": [
    {"id": "qwen3-max", "num_trades": 150, "equity": 16886.58},
    {"id": "gpt-5", "num_trades": 89, "equity": 2934.66}
  ]
}
```

**差异**:
- 交易数量：1 vs 150（本地只有示例数据）
- 账户余额：10625 vs 16886（本地是旧数据）
- 数据实时性：静态 vs 实时更新

---

## 🎯 总结

| 维度 | 本地部署 | 仅前端部署 |
|------|---------|-----------|
| **数据来源** | 本地 JSON 文件 | 远程 API |
| **数据新鲜度** | 静态（手动更新） | 实时（自动更新） |
| **数据完整性** | 有限（文件内容） | 完整（所有历史） |
| **可定制性** | ✅ 高（可编辑文件） | ❌ 低（只读） |
| **响应速度** | ✅ 极快（本地） | ⚠️ 较快（网络） |
| **网络依赖** | ❌ 无 | ✅ 需要 |
| **适用场景** | 开发、测试、演示 | 生产、实时监控 |

**建议**:
- 🛠️ **开发时**: 使用本地部署，便于调试和测试
- 🚀 **生产时**: 使用远程 API，获取实时数据
- 🔄 **混合模式**: 开发时用本地，验证时切换到远程

